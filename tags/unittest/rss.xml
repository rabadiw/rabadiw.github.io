<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>@rabadiw</title>
        <link>/</link>
        <description>A blog site covering software engineering topics, e.g. cloud native, micro services, automation.</description>
        <generator>Zola</generator>
        <language>en</language>
        <atom:link href="/tags/unittest/rss.xml" rel="self" type="application/rss+xml"/>
        <lastBuildDate>Fri, 08 May 2020 00:00:00 +0000</lastBuildDate>
        
            <item>
                <title>Port .NET UnitTest to .Net Core App 3.1</title>
                <pubDate>Fri, 08 May 2020 00:00:00 +0000</pubDate>
                <link>/blog/dotnet/port-dotnet-unittest-to-netcoreapp-3-1/</link>
                <guid>/blog/dotnet/port-dotnet-unittest-to-netcoreapp-3-1/</guid>
                <description>&lt;h3 id=&quot;project&quot;&gt;Project&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;strong&gt;Keep current project in tact.&lt;&#x2F;strong&gt; This is similar in practice as applying the &lt;a href=&quot;https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;azure&#x2F;architecture&#x2F;patterns&#x2F;strangler&quot;&gt;strangler pattern&lt;&#x2F;a&gt;. Doing so will keep the project as a point of reference. More importantly, it keeps the compiler happy and allows for porting each project independently. When selecting the project, always start with the core project (i.e. one with the least to no dependency).&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Preserve project name and namespace.&lt;&#x2F;strong&gt; When creating the project, keep the project name and namespace the same. Do choose a new folder to create the project in. This could be as simple as naming the folder &lt;code&gt;port&lt;&#x2F;code&gt;. If you choose to create a Visual Studio solution folder, make sure it does not end up in the namespace.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Create an equivalent project under the .NET Core template.&lt;&#x2F;strong&gt; For a UnitTest project create the equivalent UnitTest Core project. Doing this step will create an empty project with a .NET Core template. Mainly the &lt;code&gt;csproj&lt;&#x2F;code&gt; XML structure. Keep the same UnitTest framework. A change here would exponentially increase refactoring efforts.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;wire-up-with-di&quot;&gt;Wire up with DI&lt;&#x2F;h3&gt;
&lt;p&gt;The following code is a snapshot for demonstration purpose. The goal is to demonstrate the ability to leverage the startup code to wire up all DI requirements.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b2c2f;&quot;&gt;
&lt;span style=&quot;color:#c594c5;&quot;&gt;using &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Microsoft&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;VisualStudio&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;TestTools&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;UnitTesting&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;;

[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;TestClass&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductUnitTest
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;{
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;IHost &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;_host&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;;

    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5f6364;&quot;&gt;&#x2F;&#x2F; Setup
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;ProductUnitTest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;()
    {
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;_host &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Host&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;CreateDefaultBuilder&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;()
            .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;ConfigureWebHostDefaults&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;webBuilder &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;=&amp;gt;
            {
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;webBuilder&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;UseStartup&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;MyProductProject&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;Startup&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;gt;();
            })
            .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;ConfigureServices&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;services &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;=&amp;gt;
            {
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5f6364;&quot;&gt;&#x2F;&#x2F; potentially an in-memory database
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;services&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;AddScoped&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;DbContext&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;gt;(); 
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;services&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;AddScoped&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductController&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;gt;();
            }).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;Build&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;();        
    }

    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;controller&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt; = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;_host&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;Services&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;GetService&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductController&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;gt;();
    [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;TestMethod&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;]
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public void &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;GetProduct_ShouldSucceed&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;()
    {
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5f6364;&quot;&gt;&#x2F;&#x2F;Arrange
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;controller &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;_host&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Services&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;GetService&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductController&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;gt;();
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;productRequest &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;abc123&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;;
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;expectedProductResponse &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= 
            new &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductResponse&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;() { 
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Id &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;abc123&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;, 
                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Title &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;Product A&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot; 
            };
        
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5f6364;&quot;&gt;&#x2F;&#x2F;Act
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;var &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;actualProductResponse &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= 
            (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;controller&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;Get&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;productRequest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;) as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;JsonResult&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;)
            .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Value &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductResponse&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;;

        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5f6364;&quot;&gt;&#x2F;&#x2F;Assert
        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Assert&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;IsTrue&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;actualProductResponse&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Title &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;== &lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;expectedProductResponse&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Title&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;);
    }
}

[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;ApiController&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;]
[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Route&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;api&#x2F;[controller]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;ProductController &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;ControllerBase
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;{
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;ProductController&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;DbContext &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;db&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;)
    {
        ...
    }

    [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;HttpGet&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;]
    [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;Route&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;{id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;)]
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;JsonResult &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;Get&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;string &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;)
    {
        ...
    }
}
&lt;&#x2F;span&gt;&lt;&#x2F;pre&gt;</description>
            </item>
        
    </channel>
</rss>
